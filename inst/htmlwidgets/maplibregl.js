/*! For license information please see maplibregl.js.LICENSE.txt */
(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();var t=Object.prototype.toString,r=Array.isArray||function(e){return"[object Array]"===t.call(e)};function n(e){return"function"==typeof e}function o(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(e,t){return null!=e&&"object"==typeof e&&t in e}var a=RegExp.prototype.test,s=/\S/;var l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},p=/\s*/,c=/\s+/,u=/\s*=/,h=/\s*\}/,f=/#|\^|\/|>|\{|&|=|!/;function d(e){this.string=e,this.tail=e,this.pos=0}function g(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function v(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}d.prototype.eos=function(){return""===this.tail},d.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r},d.prototype.scanUntil=function(e){var t,r=this.tail.search(e);switch(r){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,r),this.tail=this.tail.substring(r)}return this.pos+=t.length,t},g.prototype.push=function(e){return new g(e,this)},g.prototype.lookup=function(e){var t,r,o,a=this.cache;if(a.hasOwnProperty(e))t=a[e];else{for(var s,l,p,c=this,u=!1;c;){if(e.indexOf(".")>0)for(s=c.view,l=e.split("."),p=0;null!=s&&p<l.length;)p===l.length-1&&(u=i(s,l[p])||(r=s,o=l[p],null!=r&&"object"!=typeof r&&r.hasOwnProperty&&r.hasOwnProperty(o))),s=s[l[p++]];else s=c.view[e],u=i(c.view,e);if(u){t=s;break}c=c.parent}a[e]=t}return n(t)&&(t=t.call(this.view)),t},v.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},v.prototype.parse=function(e,t){var n=this.templateCache,i=e+":"+(t||y.tags).join(":"),l=void 0!==n,g=l?n.get(i):void 0;return null==g&&(g=function(e,t){if(!e)return[];var n,i,l,g,v=!1,w=[],m=[],b=[],C=!1,k=!1,T="",x=0;function P(){if(C&&!k)for(;b.length;)delete m[b.pop()];else b=[];C=!1,k=!1}function j(e){if("string"==typeof e&&(e=e.split(c,2)),!r(e)||2!==e.length)throw new Error("Invalid tags: "+e);n=new RegExp(o(e[0])+"\\s*"),i=new RegExp("\\s*"+o(e[1])),l=new RegExp("\\s*"+o("}"+e[1]))}j(t||y.tags);for(var E,_,U,S,L,I,O=new d(e);!O.eos();){if(E=O.pos,U=O.scanUntil(n))for(var V=0,M=U.length;V<M;++V)g=S=U.charAt(V),function(e,t){return a.call(e,t)}(s,g)?(k=!0,v=!0,T+=" "):(b.push(m.length),T+=S),m.push(["text",S,E,E+1]),E+=1,"\n"===S&&(P(),T="",x=0,v=!1);if(!O.scan(n))break;if(C=!0,_=O.scan(f)||"name",O.scan(p),"="===_?(U=O.scanUntil(u),O.scan(u),O.scanUntil(i)):"{"===_?(U=O.scanUntil(l),O.scan(h),O.scanUntil(i),_="&"):U=O.scanUntil(i),!O.scan(i))throw new Error("Unclosed tag at "+O.pos);if(L=">"==_?[_,U,E,O.pos,T,x,v]:[_,U,E,O.pos],x++,m.push(L),"#"===_||"^"===_)w.push(L);else if("/"===_){if(!(I=w.pop()))throw new Error('Unopened section "'+U+'" at '+E);if(I[1]!==U)throw new Error('Unclosed section "'+I[1]+'" at '+E)}else"name"===_||"{"===_||"&"===_?k=!0:"="===_&&j(U)}if(P(),I=w.pop())throw new Error('Unclosed section "'+I[1]+'" at '+O.pos);return function(e){for(var t,r=[],n=r,o=[],i=0,a=e.length;i<a;++i)switch((t=e[i])[0]){case"#":case"^":n.push(t),o.push(t),n=t[4]=[];break;case"/":o.pop()[5]=t[2],n=o.length>0?o[o.length-1][4]:r;break;default:n.push(t)}return r}(function(e){for(var t,r,n=[],o=0,i=e.length;o<i;++o)(t=e[o])&&("text"===t[0]&&r&&"text"===r[0]?(r[1]+=t[1],r[3]=t[3]):(n.push(t),r=t));return n}(m))}(e,t),l&&n.set(i,g)),g},v.prototype.render=function(e,t,r,n){var o=this.getConfigTags(n),i=this.parse(e,o),a=t instanceof g?t:new g(t,void 0);return this.renderTokens(i,a,r,e,n)},v.prototype.renderTokens=function(e,t,r,n,o){for(var i,a,s,l="",p=0,c=e.length;p<c;++p)s=void 0,"#"===(a=(i=e[p])[0])?s=this.renderSection(i,t,r,n,o):"^"===a?s=this.renderInverted(i,t,r,n,o):">"===a?s=this.renderPartial(i,t,r,o):"&"===a?s=this.unescapedValue(i,t):"name"===a?s=this.escapedValue(i,t,o):"text"===a&&(s=this.rawValue(i)),void 0!==s&&(l+=s);return l},v.prototype.renderSection=function(e,t,o,i,a){var s=this,l="",p=t.lookup(e[1]);if(p){if(r(p))for(var c=0,u=p.length;c<u;++c)l+=this.renderTokens(e[4],t.push(p[c]),o,i,a);else if("object"==typeof p||"string"==typeof p||"number"==typeof p)l+=this.renderTokens(e[4],t.push(p),o,i,a);else if(n(p)){if("string"!=typeof i)throw new Error("Cannot use higher-order sections without the original template");null!=(p=p.call(t.view,i.slice(e[3],e[5]),(function(e){return s.render(e,t,o,a)})))&&(l+=p)}else l+=this.renderTokens(e[4],t,o,i,a);return l}},v.prototype.renderInverted=function(e,t,n,o,i){var a=t.lookup(e[1]);if(!a||r(a)&&0===a.length)return this.renderTokens(e[4],t,n,o,i)},v.prototype.indentPartial=function(e,t,r){for(var n=t.replace(/[^ \t]/g,""),o=e.split("\n"),i=0;i<o.length;i++)o[i].length&&(i>0||!r)&&(o[i]=n+o[i]);return o.join("\n")},v.prototype.renderPartial=function(e,t,r,o){if(r){var i=this.getConfigTags(o),a=n(r)?r(e[1]):r[e[1]];if(null!=a){var s=e[6],l=e[5],p=e[4],c=a;0==l&&p&&(c=this.indentPartial(a,p,s));var u=this.parse(c,i);return this.renderTokens(u,t,r,c,o)}}},v.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(null!=r)return r},v.prototype.escapedValue=function(e,t,r){var n=this.getConfigEscape(r)||y.escape,o=t.lookup(e[1]);if(null!=o)return"number"==typeof o&&n===y.escape?String(o):n(o)},v.prototype.rawValue=function(e){return e[1]},v.prototype.getConfigTags=function(e){return r(e)?e:e&&"object"==typeof e?e.tags:void 0},v.prototype.getConfigEscape=function(e){return e&&"object"==typeof e&&!r(e)?e.escape:void 0};var y={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){w.templateCache=e},get templateCache(){return w.templateCache}},w=new v;y.clearCache=function(){return w.clearCache()},y.parse=function(e,t){return w.parse(e,t)},y.render=function(e,t,n,o){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(r(i=e)?"array":typeof i)+'" was given as the first argument for mustache#render(template, view, partials)');var i;return w.render(e,t,n,o)},y.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,(function(e){return l[e]}))},y.Scanner=d,y.Context=g,y.Writer=v;const m=y;class b{constructor(e){this._map=e}addSource(e){this._map.addSource(e.id,e.src)}addControl(e){const t=this._map,r=new maplibregl[e.name](e.options);t.addControl(r,e.pos)}addLayer(e){this._map.addLayer(e.style)}addTooltip(e){const t=this._map,r=e.layerId,n=new maplibregl.Popup({closeButton:!1,closeOnClick:!1});t.on("mousemove",r,(r=>{t.getCanvas().style.cursor="pointer";const o=Object.values(r.lngLat),i=r.features[0],a=m.render(e.tooltip,i.properties);n.setLngLat(o).setHTML(a).addTo(t)})),t.on("mouseleave",r,(()=>{t.getCanvas().style.cursor="",n.remove()}))}setPaintProperty(e){this._map.setPaintProperty(e.layerId,e.property,e.value)}setLayoutProperty(e){this._map.setLayoutProperty(e.layerId,e.property,e.value)}setFilter(e){this._map.setFilter(e.layerId,e.filter)}render(e){e.forEach((({methodName:e,args:t})=>this[e](t)))}}const C=e.g.maplibreglWidget={_widgets:{}};HTMLWidgets.widget({name:"maplibregl",type:"output",factory:function(e,t,r){let n=null,o=null;const i=C._widgets[e.id]={};return HTMLWidgets.shinyMode&&Shiny.addCustomMessageHandler("maplibregl",(t=>{console.log("proxyObject",t),t.id===e.id&&(console.log("Updating "+e.id),o.render(t.widgetData.calls))})),{renderValue:function(t){console.log(t),t.mapProps.container=e.id,n=i.map=new maplibregl.Map(t.mapProps),o=i.viz=new b(n),n.on("load",(()=>o.render(t.calls)))},resize:function(e,t){}}}})})();