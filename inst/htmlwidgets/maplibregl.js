/*! For license information please see maplibregl.js.LICENSE.txt */
(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();var t=Object.prototype.toString,n=Array.isArray||function(e){return"[object Array]"===t.call(e)};function r(e){return"function"==typeof e}function o(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(e,t){return null!=e&&"object"==typeof e&&t in e}var a=RegExp.prototype.test,s=/\S/;var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},p=/\s*/,l=/\s+/,u=/\s*=/,h=/\s*\}/,f=/#|\^|\/|>|\{|&|=|!/;function d(e){this.string=e,this.tail=e,this.pos=0}function g(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function v(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}d.prototype.eos=function(){return""===this.tail},d.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},d.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},g.prototype.push=function(e){return new g(e,this)},g.prototype.lookup=function(e){var t,n,o,a=this.cache;if(a.hasOwnProperty(e))t=a[e];else{for(var s,c,p,l=this,u=!1;l;){if(e.indexOf(".")>0)for(s=l.view,c=e.split("."),p=0;null!=s&&p<c.length;)p===c.length-1&&(u=i(s,c[p])||(n=s,o=c[p],null!=n&&"object"!=typeof n&&n.hasOwnProperty&&n.hasOwnProperty(o))),s=s[c[p++]];else s=l.view[e],u=i(l.view,e);if(u){t=s;break}l=l.parent}a[e]=t}return r(t)&&(t=t.call(this.view)),t},v.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},v.prototype.parse=function(e,t){var r=this.templateCache,i=e+":"+(t||y.tags).join(":"),c=void 0!==r,g=c?r.get(i):void 0;return null==g&&(g=function(e,t){if(!e)return[];var r,i,c,g,v=!1,w=[],m=[],b=[],C=!1,k=!1,T="",x=0;function E(){if(C&&!k)for(;b.length;)delete m[b.pop()];else b=[];C=!1,k=!1}function j(e){if("string"==typeof e&&(e=e.split(l,2)),!n(e)||2!==e.length)throw new Error("Invalid tags: "+e);r=new RegExp(o(e[0])+"\\s*"),i=new RegExp("\\s*"+o(e[1])),c=new RegExp("\\s*"+o("}"+e[1]))}j(t||y.tags);for(var U,_,P,S,L,O,V=new d(e);!V.eos();){if(U=V.pos,P=V.scanUntil(r))for(var I=0,A=P.length;I<A;++I)g=S=P.charAt(I),function(e,t){return a.call(e,t)}(s,g)?(k=!0,v=!0,T+=" "):(b.push(m.length),T+=S),m.push(["text",S,U,U+1]),U+=1,"\n"===S&&(E(),T="",x=0,v=!1);if(!V.scan(r))break;if(C=!0,_=V.scan(f)||"name",V.scan(p),"="===_?(P=V.scanUntil(u),V.scan(u),V.scanUntil(i)):"{"===_?(P=V.scanUntil(c),V.scan(h),V.scanUntil(i),_="&"):P=V.scanUntil(i),!V.scan(i))throw new Error("Unclosed tag at "+V.pos);if(L=">"==_?[_,P,U,V.pos,T,x,v]:[_,P,U,V.pos],x++,m.push(L),"#"===_||"^"===_)w.push(L);else if("/"===_){if(!(O=w.pop()))throw new Error('Unopened section "'+P+'" at '+U);if(O[1]!==P)throw new Error('Unclosed section "'+O[1]+'" at '+U)}else"name"===_||"{"===_||"&"===_?k=!0:"="===_&&j(P)}if(E(),O=w.pop())throw new Error('Unclosed section "'+O[1]+'" at '+V.pos);return function(e){for(var t,n=[],r=n,o=[],i=0,a=e.length;i<a;++i)switch((t=e[i])[0]){case"#":case"^":r.push(t),o.push(t),r=t[4]=[];break;case"/":o.pop()[5]=t[2],r=o.length>0?o[o.length-1][4]:n;break;default:r.push(t)}return n}(function(e){for(var t,n,r=[],o=0,i=e.length;o<i;++o)(t=e[o])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(r.push(t),n=t));return r}(m))}(e,t),c&&r.set(i,g)),g},v.prototype.render=function(e,t,n,r){var o=this.getConfigTags(r),i=this.parse(e,o),a=t instanceof g?t:new g(t,void 0);return this.renderTokens(i,a,n,e,r)},v.prototype.renderTokens=function(e,t,n,r,o){for(var i,a,s,c="",p=0,l=e.length;p<l;++p)s=void 0,"#"===(a=(i=e[p])[0])?s=this.renderSection(i,t,n,r,o):"^"===a?s=this.renderInverted(i,t,n,r,o):">"===a?s=this.renderPartial(i,t,n,o):"&"===a?s=this.unescapedValue(i,t):"name"===a?s=this.escapedValue(i,t,o):"text"===a&&(s=this.rawValue(i)),void 0!==s&&(c+=s);return c},v.prototype.renderSection=function(e,t,o,i,a){var s=this,c="",p=t.lookup(e[1]);if(p){if(n(p))for(var l=0,u=p.length;l<u;++l)c+=this.renderTokens(e[4],t.push(p[l]),o,i,a);else if("object"==typeof p||"string"==typeof p||"number"==typeof p)c+=this.renderTokens(e[4],t.push(p),o,i,a);else if(r(p)){if("string"!=typeof i)throw new Error("Cannot use higher-order sections without the original template");null!=(p=p.call(t.view,i.slice(e[3],e[5]),(function(e){return s.render(e,t,o,a)})))&&(c+=p)}else c+=this.renderTokens(e[4],t,o,i,a);return c}},v.prototype.renderInverted=function(e,t,r,o,i){var a=t.lookup(e[1]);if(!a||n(a)&&0===a.length)return this.renderTokens(e[4],t,r,o,i)},v.prototype.indentPartial=function(e,t,n){for(var r=t.replace(/[^ \t]/g,""),o=e.split("\n"),i=0;i<o.length;i++)o[i].length&&(i>0||!n)&&(o[i]=r+o[i]);return o.join("\n")},v.prototype.renderPartial=function(e,t,n,o){if(n){var i=this.getConfigTags(o),a=r(n)?n(e[1]):n[e[1]];if(null!=a){var s=e[6],c=e[5],p=e[4],l=a;0==c&&p&&(l=this.indentPartial(a,p,s));var u=this.parse(l,i);return this.renderTokens(u,t,n,l,o)}}},v.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},v.prototype.escapedValue=function(e,t,n){var r=this.getConfigEscape(n)||y.escape,o=t.lookup(e[1]);if(null!=o)return"number"==typeof o&&r===y.escape?String(o):r(o)},v.prototype.rawValue=function(e){return e[1]},v.prototype.getConfigTags=function(e){return n(e)?e:e&&"object"==typeof e?e.tags:void 0},v.prototype.getConfigEscape=function(e){return e&&"object"==typeof e&&!n(e)?e.escape:void 0};var y={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){w.templateCache=e},get templateCache(){return w.templateCache}},w=new v;y.clearCache=function(){return w.clearCache()},y.parse=function(e,t){return w.parse(e,t)},y.render=function(e,t,r,o){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(n(i=e)?"array":typeof i)+'" was given as the first argument for mustache#render(template, view, partials)');var i;return w.render(e,t,r,o)},y.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,(function(e){return c[e]}))},y.Scanner=d,y.Context=g,y.Writer=v;const m=y;class b{constructor(e){this._map=e}addSource(e){this._map.addSource(e.id,e.src)}addControl(e){const t=this._map,n=new maplibregl[e.name](e.options);t.addControl(n,e.pos)}addLayer(e){this._map.addLayer(e.style)}addTooltip(e){const t=this._map,n=e.layerId,r=new maplibregl.Popup({closeButton:!1,closeOnClick:!1});t.on("mousemove",n,(n=>{t.getCanvas().style.cursor="pointer";const o=Object.values(n.lngLat),i=n.features[0],a=m.render(e.tooltip,i.properties);r.setLngLat(o).setHTML(a).addTo(t)})),t.on("mouseleave",n,(()=>{t.getCanvas().style.cursor="",r.remove()}))}render(e){e.forEach((({methodName:e,args:t})=>this[e](t)))}}const C=e.g.maplibreglWidget={_widgets:{}};HTMLWidgets.widget({name:"maplibregl",type:"output",factory:function(e,t,n){let r=null,o=null;const i=C._widgets[e.id]={};return{renderValue:function(t){console.log(t),t.mapProps.container=e.id,r=i.map=new maplibregl.Map(t.mapProps),o=i.viz=new b(r),r.on("load",(()=>o.render(t.calls)))},resize:function(e,t){}}}})})();